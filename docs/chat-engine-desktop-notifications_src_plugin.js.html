<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: chat-engine-desktop-notifications/src/plugin.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: chat-engine-desktop-notifications/src/plugin.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
* @module desktop-notifications
*/

const defaults = {timeout: 1000};

/**
* @param {Object} config The config object
* @param {Function} config.title The title of the desktop notification
* @param {module:desktop-notifications~message} config.message [description]
* @ceextends Chat
* @example
* room.chat.plugin(ChatEngineCore.plugin['chat-engine-desktop-notifications']({
*     title: (event) => {
*         return 'Message In ' + room.name
*     },
*     message: (event) => {
*         return event.data.text;
*     },
*     icon: (event) => {
*         return '/examples/flowtron/logo@2x.png';
*     },
*     callback: (event) => {
*         window.focus();
*     }
* }));
*/
const plugin = (config) => {

    // request permission on page load
    document.addEventListener('DOMContentLoaded', function () {
      if (!Notification) {
        alert('Desktop notifications not available in your browser. Try Chromium.');
        return;
      }

      if (Notification.permission !== "granted")
        Notification.requestPermission();
    });

    let lastNotification = false;

    function notifyMe(title, icon, body, callback) {

      if(lastNotification) {

        lastNotification.close();
        lastNotification = false;

      }

      if (Notification.permission !== "granted") {
        Notification.requestPermission();
      } else {

        lastNotification = new Notification(title || 'Notification title', {
          icon: icon || 'http://cdn.sstatic.net/stackexchange/img/logos/so/so-icon.png',
          body: body || "Hey there! You've been notified!",
        });


      /**
       * Fired when the desktop notification is clicked on by the user.
       * @callback callback
       * @param {Object} event
       */
        lastNotification.onclick = callback;

      }

    }

    // Set the name of the hidden property and the change event for visibility
    var hidden, visibilityChange;
    if (typeof document.hidden !== "undefined") { // Opera 12.10 and Firefox 18 and later support
      hidden = "hidden";
      visibilityChange = "visibilitychange";
    } else if (typeof document.msHidden !== "undefined") {
      hidden = "msHidden";
      visibilityChange = "msvisibilitychange";
    } else if (typeof document.webkitHidden !== "undefined") {
      hidden = "webkitHidden";
      visibilityChange = "webkitvisibilitychange";
    }

    let defaultTitle = (event) => {
        return 'New Message In ' + event.chat.channel;
    };

    let defaultIcon = (event) => {
        return false
    };

    let defaultMessage = (event) => {
        return JSON.stringify(event.data);
    };

    let defaultCallback = (event) => {
      window.focus();
      return false;
    };

    config.title = config.title || defaultTitle;
    config.icon = config.icon || defaultIcon;
    config.message = config.message || defaultMessage;
    config.callback = config.callback || defaultCallback;

    let isVisible = true;

    function handleVisibilityChange() {
      if (document[hidden]) {
        isVisible = false;
      } else {
        isVisible = true;
      }
    }

    // Warn if the browser doesn't support addEventListener or the Page Visibility API
    if (typeof document.addEventListener === "undefined" || typeof document[hidden] === "undefined") {
      console.log("This demo requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API.");
    } else {
      // Handle page visibility change
      document.addEventListener(visibilityChange, handleVisibilityChange, false);
    }

    class extension {

        construct() {

            this.parent.on('message', (event) => {

                if(!isVisible) {

                /**
                 * Provides a template function to generate a notification title.
                 * @callback title
                 * @param {Object} title
                 */

                /**
                 * Provides a template function to generate a notification icon.
                 * @callback icon
                 * @param {Object} event
                 */

                /**
                 * Provides a template function to generate a notification message.
                 * @callback message
                 * @param {Object} event
                 */
                  notifyMe(config.title(event), config.icon(event), config.message(event), config.callback);
                }

            });

        }

    };

    // attach methods to Chat
    return {
        namespace: 'desktop-notifications',
        extends: {
            Chat: extension
        }
    }

}

module.exports = plugin;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-desktop-notifications.html">desktop-notifications</a></li></ul><h3>Classes</h3><ul><li><a href="Chat.html">Chat</a></li><li><a href="ChatEngine.html">ChatEngine</a></li><li><a href="Emitter.html">Emitter</a></li><li><a href="Event.html">Event</a></li><li><a href="Me.html">Me</a></li><li><a href="RootEmitter.html">RootEmitter</a></li><li><a href="User.html">User</a></li></ul><h3>Events</h3><ul><li><a href="Chat.html#event:$%2522.%2522disconnect">$"."disconnect</a></li><li><a href="Chat.html#event:$%2522.%2522join">$"."join</a></li><li><a href="Chat.html#event:$%2522.%2522leave">$"."leave</a></li><li><a href="Chat.html#event:$%2522.%2522offline">$"."offline</a></li><li><a href="Chat.html#event:$%2522.%2522online">$"."online</a></li><li><a href="Chat.html#event:$%2522.%2522ready">$"."ready</a></li><li><a href="Chat.html#event:$%2522.%2522state">$"."state</a></li><li><a href="typingIndicator.html#.event:$typingIndiciator%2522.%2522startTyping">$typingIndiciator"."startTyping</a></li><li><a href="uploadcare.html#.event:$uploadcare%2522.%2522upload">$uploadcare"."upload</a></li></ul><h3>Namespaces</h3><ul><li><a href="emoji.html">emoji</a></li><li><a href="typingIndicator.html">typingIndicator</a></li><li><a href="uploadcare.html">uploadcare</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-angular.html">Angular</a></li><li><a href="tutorial-concepts.html">Concepts</a></li><li><a href="tutorial-getting-started.html">Getting Started</a></li><li><a href="tutorial-jquery.html">jQuery</a></li><li><a href="tutorial-js.html">Javacsript</a></li><li><a href="tutorial-nodejs.html">NodeJS</a></li><li><a href="tutorial-react.html">React</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ChatEngineCore">ChatEngineCore</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.2</a> on Thu Jul 27 2017 10:54:42 GMT-0500 (CDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>

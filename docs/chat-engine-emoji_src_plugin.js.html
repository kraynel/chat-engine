<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: chat-engine-emoji/src/plugin.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: chat-engine-emoji/src/plugin.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
* @namespace typingIndicator
* @requires {@link ChatEngine}
* @param {Object} config
*/
const emojis = require('./emoji.js');
const dotty = require("dotty");

// this is an example of middleware used in our test.js
// adds some text to message before it's sent and when it's received
module.exports = (config) => {

    // regular expression to find emoji strings
    const test = /:[a-z0-9_\-\+]+:/g;

    // create empty config object if not supplied
    config = config || {};

    // where in the payload the text is
    config.prop = config.prop || 'data.text';

    config.height = config.height || 16;

    // where emoji images are hosted. filename (ex: /smile.png) will be added
    config.url = config.url || 'http://www.webpagefx.com/tools/emoji-cheat-sheet/graphics/emojis';

    // function to parse string for :smile: and other emoji
    const emoji = (someString, url = config.url, height = config.height) => someString.replace(test, (match) => {

        // use regex to find emoji and replace with html
        let result = match;

        // if text string is in list of emojis
        if (emojis.indexOf(match) !== -1) {

            // remove the : before and after
            let name = String(match).slice(1, -1);

            // return html image, using url and height supplied in
            // function
            result = '&lt;img class="emoji" title=":' + name
                + ':" alt="' + name + '" src="' + url + '/'
                + encodeURIComponent(name) + '.png"'
                + (height ? (' height="' + height + '"') : '')
                + ' />';

        }

        return result;

    });

    let parseEmoji = function(payload, next) {

        let message = dotty.get(payload, config.prop);

        // check if this sub property exists
        if(message.length) {

            // parse emoji
            let newPayload = emoji(message, config.url, config.height);
            dotty.put(payload, config.prop, newPayload);

        }

        // continue along middleware
        next(null, payload);

    };

    // these are new methods that will be added to the extended class
    class extension {
        render(string, url, height) {
            return emoji(string, url, height);
        }
        search(query) {

            var results = [];

            for(var i in emojis) {
                if(emojis[i].substring(0, query.length) == query) {
                    results.push(emojis[i]);
                }
            }

            return results;

        }
    }

    // middleware tells the framework to use these functions when
    // messages are sent or received
    return {
        namespace: 'emoji',
        middleware: {
            on: {
                'message': parseEmoji,
                '$history.message': parseEmoji
            }
        },
        extends: {
            Chat: extension,
            GlobalChat: extension
        }
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-desktop-notifications.html">desktop-notifications</a></li></ul><h3>Classes</h3><ul><li><a href="Chat.html">Chat</a></li><li><a href="ChatEngine.html">ChatEngine</a></li><li><a href="Emitter.html">Emitter</a></li><li><a href="Event.html">Event</a></li><li><a href="Me.html">Me</a></li><li><a href="RootEmitter.html">RootEmitter</a></li><li><a href="User.html">User</a></li></ul><h3>Events</h3><ul><li><a href="Chat.html#event:$%2522.%2522disconnect">$"."disconnect</a></li><li><a href="Chat.html#event:$%2522.%2522join">$"."join</a></li><li><a href="Chat.html#event:$%2522.%2522leave">$"."leave</a></li><li><a href="Chat.html#event:$%2522.%2522offline">$"."offline</a></li><li><a href="Chat.html#event:$%2522.%2522online">$"."online</a></li><li><a href="Chat.html#event:$%2522.%2522ready">$"."ready</a></li><li><a href="Chat.html#event:$%2522.%2522state">$"."state</a></li><li><a href="typingIndicator.html#.event:$typingIndiciator%2522.%2522startTyping">$typingIndiciator"."startTyping</a></li><li><a href="uploadcare.html#.event:$uploadcare%2522.%2522upload">$uploadcare"."upload</a></li></ul><h3>Namespaces</h3><ul><li><a href="emoji.html">emoji</a></li><li><a href="typingIndicator.html">typingIndicator</a></li><li><a href="uploadcare.html">uploadcare</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-angular.html">Angular</a></li><li><a href="tutorial-concepts.html">Concepts</a></li><li><a href="tutorial-getting-started.html">Getting Started</a></li><li><a href="tutorial-jquery.html">jQuery</a></li><li><a href="tutorial-js.html">Javacsript</a></li><li><a href="tutorial-nodejs.html">NodeJS</a></li><li><a href="tutorial-react.html">React</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ChatEngineCore">ChatEngineCore</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.2</a> on Thu Jul 27 2017 10:54:42 GMT-0500 (CDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
